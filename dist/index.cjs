"use strict";var f=Object.create;var d=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var R=(o,e)=>{for(var t in e)d(o,t,{get:e[t],enumerable:!0})},m=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of E(e))!N.call(o,a)&&a!==t&&d(o,a,{get:()=>e[a],enumerable:!(r=I(e,a))||r.enumerable});return o};var D=(o,e,t)=>(t=o!=null?f(U(o)):{},m(e||!o||!o.__esModule?d(t,"default",{value:o,enumerable:!0}):t,o)),w=o=>m(d({},"__esModule",{value:!0}),o);var c=(o,e,t)=>new Promise((r,a)=>{var l=n=>{try{u(t.next(n))}catch(s){a(s)}},h=n=>{try{u(t.throw(n))}catch(s){a(s)}},u=n=>n.done?r(n.value):Promise.resolve(n.value).then(l,h);u((t=t.apply(o,e)).next())});var y={};R(y,{default:()=>p});module.exports=w(y);var i=D(require("axios"));var p=class{constructor(e){this.accessToken=e;this.LINKEDIN_BASE_URL="https://api.linkedin.com";this.LINKEDIN_VERSION="202303"}getProfileData(){return c(this,null,function*(){var e;try{return(yield(0,i.default)(`${this.LINKEDIN_BASE_URL}/v2/me`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`}})).data}catch(t){return t instanceof i.AxiosError?(console.error("Cannot get profile data. Error: ",(e=t.response)==null?void 0:e.data),null):(console.error("Something went wrong. Error: ",t),null)}})}getPersonURN(){return c(this,null,function*(){let e=yield this.getProfileData();return!e||!e.id?null:`urn:li:person:${e.id}`})}createImageUploadRequest(e){return c(this,null,function*(){var t;try{return(yield(0,i.default)(`${this.LINKEDIN_BASE_URL}/rest/images?action=initializeUpload`,{method:"POST",headers:{"LinkedIn-Version":this.LINKEDIN_VERSION,Authorization:`Bearer ${this.accessToken}`,"X-Restli-Protocol-Version":"2.0.0"},data:{initializeUploadRequest:{owner:e}}})).data}catch(r){if(r instanceof i.AxiosError){console.error("Cannot create image upload request. Error: ",(t=r.response)==null?void 0:t.data);return}console.error("Something went wrong. Error: ",r)}})}uploadImage(e,t){return c(this,null,function*(){try{let r=yield(0,i.default)(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream",Authorization:`Bearer ${this.accessToken}`},data:e});return r.status!==201?(console.error("Image not created. Status code: ",r.status),!1):!0}catch(r){if(r instanceof i.AxiosError){console.error("Cannot upload image. Error: ",r.cause);return}console.error("Something went wrong. Error: ",r)}})}createPostWithImage(e,t,r){return c(this,null,function*(){var n;let a=yield this.getPersonURN();if(!a){console.error("Cannot get person URN");return}let l=yield this.createImageUploadRequest(a);if(!l){console.error("Cannot create image upload request");return}if(!(yield this.uploadImage(t,l.value.uploadUrl))){console.error("Cannot upload the image");return}let u=l.value.image;try{let s={author:a,commentary:e,visibility:"PUBLIC",distribution:{feedDistribution:"MAIN_FEED",targetEntities:[],thirdPartyDistributionChannels:[]},content:{media:{title:r!=null?r:"Cover image of the post",id:u}},lifecycleState:"PUBLISHED",isReshareDisabledByAuthor:!1};console.log(s);let g=yield(0,i.default)(`${this.LINKEDIN_BASE_URL}/rest/posts`,{method:"POST",headers:{"LinkedIn-Version":this.LINKEDIN_VERSION,Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0"},data:s});return g.status!==201?(console.error("Image not created. Status code: ",g.status),!1):!0}catch(s){if(s instanceof i.AxiosError){console.error("Cannot create post. Error: ",(n=s.response)==null?void 0:n.data);return}console.error("Something went wrong. Error: ",s)}})}};0&&(module.exports={});
