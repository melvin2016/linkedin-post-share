"use strict";var I=Object.create;var p=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var D=(a,e)=>{for(var t in e)p(a,t,{get:e[t],enumerable:!0})},f=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of R(e))!N.call(a,o)&&o!==t&&p(a,o,{get:()=>e[o],enumerable:!(r=E(e,o))||r.enumerable});return a};var v=(a,e,t)=>(t=a!=null?I(U(a)):{},f(e||!a||!a.__esModule?p(t,"default",{value:a,enumerable:!0}):t,a)),w=a=>f(p({},"__esModule",{value:!0}),a);var c=(a,e,t)=>new Promise((r,o)=>{var l=s=>{try{u(t.next(s))}catch(i){o(i)}},m=s=>{try{u(t.throw(s))}catch(i){o(i)}},u=s=>s.done?r(s.value):Promise.resolve(s.value).then(l,m);u((t=t.apply(a,e)).next())});var y={};D(y,{default:()=>h});module.exports=w(y);var n=v(require("axios"));var h=class{constructor(e){this.accessToken=e;this.LINKEDIN_BASE_URL="https://api.linkedin.com";this.LINKEDIN_VERSION="202303"}getProfileData(){return c(this,null,function*(){var e;try{return(yield(0,n.default)(`${this.LINKEDIN_BASE_URL}/v2/me`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`}})).data}catch(t){return t instanceof n.AxiosError?(console.error("Cannot get profile data. Error: ",(e=t.response)==null?void 0:e.data),null):(console.error("Something went wrong. Error: ",t),null)}})}getPersonURN(){return c(this,null,function*(){let e=yield this.getProfileData();return!e||!e.id?null:`urn:li:person:${e.id}`})}createImageUploadRequest(e){return c(this,null,function*(){var t;try{return(yield(0,n.default)(`${this.LINKEDIN_BASE_URL}/rest/images?action=initializeUpload`,{method:"POST",headers:{"LinkedIn-Version":this.LINKEDIN_VERSION,Authorization:`Bearer ${this.accessToken}`,"X-Restli-Protocol-Version":"2.0.0"},data:{initializeUploadRequest:{owner:e}}})).data}catch(r){if(r instanceof n.AxiosError){console.error("Cannot create image upload request. Error: ",(t=r.response)==null?void 0:t.data);return}console.error("Something went wrong. Error: ",r)}})}uploadImage(e,t){return c(this,null,function*(){try{let r=yield(0,n.default)(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream",Authorization:`Bearer ${this.accessToken}`},data:e});return r.status!==201?(console.error("Image not created. Status code: ",r.status),!1):!0}catch(r){if(r instanceof n.AxiosError){console.error("Cannot upload image. Error: ",r.cause);return}console.error("Something went wrong. Error: ",r)}})}removeLinkedinReservedCharacters(e){return e.replace(/[|{}@\[\]()<>\\*_~+]/gm,"")}createPostWithImage(e,t,r){return c(this,null,function*(){var i;let o=yield this.getPersonURN();if(!o){console.error("Cannot get person URN");return}let l=yield this.createImageUploadRequest(o);if(!l){console.error("Cannot create image upload request");return}if(!(yield this.uploadImage(t,l.value.uploadUrl))){console.error("Cannot upload the image");return}let u=l.value.image,s=this.removeLinkedinReservedCharacters(e);try{let d={author:o,commentary:s,visibility:"PUBLIC",distribution:{feedDistribution:"MAIN_FEED",targetEntities:[],thirdPartyDistributionChannels:[]},content:{media:{title:r!=null?r:"Cover image of the post",id:u}},lifecycleState:"PUBLISHED",isReshareDisabledByAuthor:!1},g=yield(0,n.default)(`${this.LINKEDIN_BASE_URL}/rest/posts`,{method:"POST",headers:{"LinkedIn-Version":this.LINKEDIN_VERSION,Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0"},data:d});return g.status!==201?(console.error("Image not created. Status code: ",g.status),!1):!0}catch(d){if(d instanceof n.AxiosError){console.error("Cannot create post. Error: ",(i=d.response)==null?void 0:i.data);return}console.error("Something went wrong. Error: ",d)}})}};0&&(module.exports={});
