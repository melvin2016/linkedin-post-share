var s=(h,e,t)=>new Promise((r,o)=>{var i=a=>{try{c(t.next(a))}catch(n){o(n)}},m=a=>{try{c(t.throw(a))}catch(n){o(n)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,m);c((t=t.apply(h,e)).next())});import u,{AxiosError as d}from"axios";var p=class{constructor(e){this.accessToken=e;this.LINKEDIN_BASE_URL="https://api.linkedin.com";this.LINKEDIN_VERSION="202303"}getProfileData(){return s(this,null,function*(){var e;try{return(yield u(`${this.LINKEDIN_BASE_URL}/v2/me`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`}})).data}catch(t){return t instanceof d?(console.error("Cannot get profile data. Error: ",(e=t.response)==null?void 0:e.data),null):(console.error("Something went wrong. Error: ",t),null)}})}getPersonURN(){return s(this,null,function*(){let e=yield this.getProfileData();return!e||!e.id?null:`urn:li:person:${e.id}`})}createImageUploadRequest(e){return s(this,null,function*(){var t;try{return(yield u(`${this.LINKEDIN_BASE_URL}/rest/images?action=initializeUpload`,{method:"POST",headers:{"LinkedIn-Version":this.LINKEDIN_VERSION,Authorization:`Bearer ${this.accessToken}`,"X-Restli-Protocol-Version":"2.0.0"},data:{initializeUploadRequest:{owner:e}}})).data}catch(r){if(r instanceof d){console.error("Cannot create image upload request. Error: ",(t=r.response)==null?void 0:t.data);return}console.error("Something went wrong. Error: ",r)}})}uploadImage(e,t){return s(this,null,function*(){try{let r=yield u(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream",Authorization:`Bearer ${this.accessToken}`},data:e});return r.status!==201?(console.error("Image not created. Status code: ",r.status),!1):!0}catch(r){if(r instanceof d){console.error("Cannot upload image. Error: ",r.cause);return}console.error("Something went wrong. Error: ",r)}})}removeLinkedinReservedCharacters(e){return e.replace(/[|{}@\[\]()<>\\*_~+]/gm,"")}createPostWithImage(e,t,r){return s(this,null,function*(){var n;let o=yield this.getPersonURN();if(!o){console.error("Cannot get person URN");return}let i=yield this.createImageUploadRequest(o);if(!i){console.error("Cannot create image upload request");return}if(!(yield this.uploadImage(t,i.value.uploadUrl))){console.error("Cannot upload the image");return}let c=i.value.image,a=this.removeLinkedinReservedCharacters(e);try{let l={author:o,commentary:a,visibility:"PUBLIC",distribution:{feedDistribution:"MAIN_FEED",targetEntities:[],thirdPartyDistributionChannels:[]},content:{media:{title:r!=null?r:"Cover image of the post",id:c}},lifecycleState:"PUBLISHED",isReshareDisabledByAuthor:!1},g=yield u(`${this.LINKEDIN_BASE_URL}/rest/posts`,{method:"POST",headers:{"LinkedIn-Version":this.LINKEDIN_VERSION,Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0"},data:l});return g.status!==201?(console.error("Image not created. Status code: ",g.status),!1):!0}catch(l){if(l instanceof d){console.error("Cannot create post. Error: ",(n=l.response)==null?void 0:n.data);return}console.error("Something went wrong. Error: ",l)}})}};export{p as default};
