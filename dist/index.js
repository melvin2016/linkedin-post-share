var s=(p,t,e)=>new Promise((o,r)=>{var i=a=>{try{c(e.next(a))}catch(n){r(n)}},m=a=>{try{c(e.throw(a))}catch(n){r(n)}},c=a=>a.done?o(a.value):Promise.resolve(a.value).then(i,m);c((e=e.apply(p,t)).next())});import l,{AxiosError as u}from"axios";import g from"cross-blob";var d=class{constructor(t){this.accessToken=t;this.LINKEDIN_BASE_URL="https://api.linkedin.com";this.LINKEDIN_VERSION="202303"}getProfileData(){return s(this,null,function*(){var t;try{return(yield l(`${this.LINKEDIN_BASE_URL}/v2/me`,{method:"GET",headers:{Authorization:`Bearer ${this.accessToken}`}})).data}catch(e){return e instanceof u?(console.error("Cannot get profile data. Error: ",(t=e.response)==null?void 0:t.data),null):(console.error("Something went wrong. Error: ",e),null)}})}getPersonURN(){return s(this,null,function*(){let t=yield this.getProfileData();return!t||!t.id?null:`urn:li:person:${t.id}`})}createImageUploadRequest(t){return s(this,null,function*(){var e;try{return(yield l(`${this.LINKEDIN_BASE_URL}/rest/images?action=initializeUpload`,{method:"POST",headers:{"LinkedIn-Version":this.LINKEDIN_VERSION,Authorization:`Bearer ${this.accessToken}`,"X-Restli-Protocol-Version":"2.0.0"},data:{initializeUploadRequest:{owner:t}}})).data}catch(o){if(o instanceof u){console.error("Cannot create image upload request. Error: ",(e=o.response)==null?void 0:e.data);return}console.error("Something went wrong. Error: ",o)}})}uploadImage(t,e){return s(this,null,function*(){let o=new g([t]);try{let r=yield l(e,{method:"PUT",headers:{"Content-Type":"application/octet-stream",Authorization:`Bearer ${this.accessToken}`},data:o});return r.status!==201?(console.error("Image not created. Status code: ",r.status),!1):!0}catch(r){if(r instanceof u){console.error("Cannot upload image. Error: ",r.cause);return}console.error("Something went wrong. Error: ",r)}})}createPostWithImage(t,e,o){return s(this,null,function*(){var a;let r=yield this.getPersonURN();if(!r){console.error("Cannot get person URN");return}let i=yield this.createImageUploadRequest(r);if(!i){console.error("Cannot create image upload request");return}if(!(yield this.uploadImage(e,i.value.uploadUrl))){console.error("Cannot upload the image");return}let c=i.value.image;try{let n={author:r,commentary:t,visibility:"PUBLIC",distribution:{feedDistribution:"MAIN_FEED",targetEntities:[],thirdPartyDistributionChannels:[]},content:{media:{title:o!=null?o:"Cover image of the post",id:c}},lifecycleState:"PUBLISHED",isReshareDisabledByAuthor:!1},h=yield l(`${this.LINKEDIN_BASE_URL}/rest/posts`,{method:"POST",headers:{"LinkedIn-Version":this.LINKEDIN_VERSION,Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json","X-Restli-Protocol-Version":"2.0.0"},data:n});return h.status!==201?(console.error("Image not created. Status code: ",h.status),!1):!0}catch(n){if(n instanceof u){console.error("Cannot create post. Error: ",(a=n.response)==null?void 0:a.data);return}console.error("Something went wrong. Error: ",n)}})}};export{d as default};
